<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sayho.workoutcalendar.dao.ChartDao">
  
  <select id="getMonthlyChartData" parameterType="java.util.Map" resultType="java.util.Map">
    SELECT WO_DT,
           SUM(CASE WHEN PART_MAIN_COD = '11' THEN VOLUME ELSE 0 END) CHEST,
           SUM(CASE WHEN PART_MAIN_COD = '12' THEN VOLUME ELSE 0 END) BACK,
           SUM(CASE WHEN PART_MAIN_COD = '21' THEN VOLUME ELSE 0 END) LEG
    FROM ICTWORKOUTRECORD
    WHERE USR_ID = 'sehoakasayho'
    AND WO_DT BETWEEN TO_CHAR(
                              TO_DATE(#{startDate}, 'YYYYMMDD')
                              + CONCAT('-', #{months}::INTEGER, ' MONTHS')::INTERVAL
                              ,'YYYYMMDD') AND #{startDate}
    GROUP BY WO_DT
    ORDER BY WO_DT
  </select>
</mapper>